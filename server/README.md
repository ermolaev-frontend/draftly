# WebSocket Server с поддержкой комнат

WebSocket сервер на Node.js с поддержкой комнат, который принимает массив объектов как сообщения.

## Установка

```bash
cd server
npm install
```

## Запуск

### Обычный режим
```bash
npm start
```

### Режим разработки (с автоперезагрузкой)
```bash
npm run dev
```

Сервер запустится на порту 3002 (или на порту, указанном в переменной окружения PORT).

## Использование

### Подключение
WebSocket сервер доступен по адресу: `ws://localhost:3002`

### Комнаты
Сервер поддерживает систему комнат. Клиенты должны присоединиться к комнате перед отправкой данных.

#### Присоединение к комнате
```json
{
  "type": "join_room",
  "roomId": "room1"
}
```

#### Выход из комнаты
```json
{
  "type": "leave_room"
}
```

### Формат сообщений
Сервер ожидает JSON массив объектов (только после присоединения к комнате). Пример:

```json
[
  {"id": 1, "name": "Первый объект", "type": "test"},
  {"id": 2, "name": "Второй объект", "value": 42},
  {"id": 3, "name": "Третий объект", "active": true}
]
```

### Ответы сервера

#### Успешное получение массива
```json
{
  "type": "array_received",
  "roomId": "room1",
  "count": 3,
  "timestamp": "2024-01-01T12:00:00.000Z",
  "data": [...]
}
```

#### Присоединение к комнате
```json
{
  "type": "room_joined",
  "roomId": "room1",
  "clientsInRoom": 2,
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

#### Выход из комнаты
```json
{
  "type": "room_left",
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

#### Уведомления о других клиентах
```json
{
  "type": "client_joined",
  "roomId": "room1",
  "clientsInRoom": 3,
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

#### Ошибка формата
```json
{
  "type": "error",
  "message": "Ожидается массив объектов",
  "received": "object",
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

#### Broadcast сообщение (отправляется всем клиентам в комнате)
```json
{
  "type": "broadcast",
  "roomId": "room1",
  "count": 3,
  "timestamp": "2024-01-01T12:00:00.000Z",
  "data": [...]
}
```

## Тестирование

Откройте файл `test-client.html` в браузере для тестирования сервера. Клиент автоматически подключится к серверу и позволит:

- Отправлять тестовые данные
- Отправлять кастомные JSON массивы
- Просматривать все входящие и исходящие сообщения

## Функциональность

- ✅ Прием WebSocket подключений
- ✅ Система комнат с изоляцией сообщений
- ✅ Присоединение/выход из комнат
- ✅ Валидация входящих сообщений (ожидается массив объектов)
- ✅ Обработка каждого объекта в массиве
- ✅ Отправка подтверждений клиентам
- ✅ Broadcast сообщений всем клиентам в комнате
- ✅ Уведомления о подключении/отключении клиентов
- ✅ Автоматическое удаление пустых комнат
- ✅ Обработка ошибок и некорректного JSON
- ✅ Логирование всех операций
- ✅ Graceful shutdown при завершении работы 