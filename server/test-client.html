<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .connected { background-color: #d4edda; color: #155724; }
        .disconnected { background-color: #f8d7da; color: #721c24; }
        .message { background-color: #d1ecf1; color: #0c5460; margin: 5px 0; padding: 10px; border-radius: 3px; }
        .error { background-color: #f8d7da; color: #721c24; }
        textarea {
            width: 100%;
            height: 150px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        #messages {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>WebSocket Test Client</h1>
    
    <div id="status" class="status disconnected">–û—Ç–∫–ª—é—á–µ–Ω–æ</div>
    
            <div>
            <button onclick="connect()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
            <button onclick="disconnect()">–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
            <button onclick="sendTestData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="clearMessages()">–û—á–∏—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è</button>
        </div>
        
        <div>
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–∞–º–∏:</h3>
            <input type="text" id="roomInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" value="room1">
            <button onclick="joinRoom()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ</button>
            <button onclick="leaveRoom()">–ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
            <div id="roomStatus">–ù–µ –≤ –∫–æ–º–Ω–∞—Ç–µ</div>
        </div>
    
    <div>
        <h3>–í–≤–µ–¥–∏—Ç–µ JSON –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤:</h3>
        <textarea id="messageInput" placeholder='[{"id": 1, "name": "test"}, {"id": 2, "value": "example"}]'>
[
  {"id": 1, "name": "–ü–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç", "type": "test"},
  {"id": 2, "name": "–í—Ç–æ—Ä–æ–π –æ–±—ä–µ–∫—Ç", "value": 42},
  {"id": 3, "name": "–¢—Ä–µ—Ç–∏–π –æ–±—ä–µ–∫—Ç", "active": true}
]
        </textarea>
        <button onclick="sendCustomData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    
    <h3>–°–æ–æ–±—â–µ–Ω–∏—è:</h3>
    <div id="messages"></div>

    <script>
        let ws = null;
        let currentRoom = null;
        const messagesDiv = document.getElementById('messages');
        const statusDiv = document.getElementById('status');
        const roomStatusDiv = document.getElementById('roomStatus');

        function updateStatus(connected) {
            statusDiv.textContent = connected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–û—Ç–∫–ª—é—á–µ–Ω–æ';
            statusDiv.className = `status ${connected ? 'connected' : 'disconnected'}`;
        }

        function addMessage(message, type = 'message') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function connect() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                addMessage('–£–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                return;
            }

            ws = new WebSocket('ws://localhost:3002');

            ws.onopen = function() {
                updateStatus(true);
                addMessage('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            };

            ws.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ –∫–æ–º–Ω–∞—Ç–∞—Ö
                    if (data.type === 'room_joined') {
                        updateRoomStatus(data.roomId);
                        addMessage(`‚úÖ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –∫–æ–º–Ω–∞—Ç–µ: ${data.roomId} (–∫–ª–∏–µ–Ω—Ç–æ–≤: ${data.clientsInRoom})`);
                    } else if (data.type === 'room_left') {
                        updateRoomStatus(null);
                        addMessage('‚úÖ –ü–æ–∫–∏–Ω—É–ª–∏ –∫–æ–º–Ω–∞—Ç—É');
                    } else if (data.type === 'client_joined') {
                        addMessage(`üëã –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ ${data.roomId} (–∫–ª–∏–µ–Ω—Ç–æ–≤: ${data.clientsInRoom})`);
                    } else if (data.type === 'client_left') {
                        addMessage(`üëã –ö–ª–∏–µ–Ω—Ç –ø–æ–∫–∏–Ω—É–ª –∫–æ–º–Ω–∞—Ç—É ${data.roomId} (–∫–ª–∏–µ–Ω—Ç–æ–≤: ${data.clientsInRoom})`);
                    } else if (data.type === 'client_disconnected') {
                        addMessage(`‚ùå –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è –∏–∑ –∫–æ–º–Ω–∞—Ç—ã ${data.roomId} (–∫–ª–∏–µ–Ω—Ç–æ–≤: ${data.clientsInRoom})`);
                    } else if (data.type === 'connection') {
                        addMessage(`üîó ${data.message} (–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã: ${data.availableRooms.join(', ') || '–Ω–µ—Ç'})`);
                    } else {
                        addMessage(`–ü–æ–ª—É—á–µ–Ω–æ: ${JSON.stringify(data, null, 2)}`);
                    }
                } catch (e) {
                    addMessage(`–ü–æ–ª—É—á–µ–Ω–æ: ${event.data}`);
                }
            };

            ws.onclose = function() {
                updateStatus(false);
                addMessage('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
            };

            ws.onerror = function(error) {
                addMessage(`–û—à–∏–±–∫–∞: ${error}`, 'error');
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }

        function sendTestData() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                return;
            }

            if (!currentRoom) {
                addMessage('–°–Ω–∞—á–∞–ª–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ –∫–æ–º–Ω–∞—Ç–µ', 'error');
                return;
            }

            const testData = [
                { id: 1, name: "–¢–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç 1", timestamp: new Date().toISOString(), room: currentRoom },
                { id: 2, name: "–¢–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç 2", value: Math.random(), room: currentRoom },
                { id: 3, name: "–¢–µ—Å—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç 3", active: true, room: currentRoom }
            ];

            ws.send(JSON.stringify(testData));
            addMessage(`üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–º–Ω–∞—Ç—É ${currentRoom}: ${JSON.stringify(testData, null, 2)}`);
        }

        function sendCustomData() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                return;
            }

            if (!currentRoom) {
                addMessage('–°–Ω–∞—á–∞–ª–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ –∫–æ–º–Ω–∞—Ç–µ', 'error');
                return;
            }

            const input = document.getElementById('messageInput').value;
            try {
                const data = JSON.parse(input);
                ws.send(JSON.stringify(data));
                addMessage(`üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–º–Ω–∞—Ç—É ${currentRoom}: ${JSON.stringify(data, null, 2)}`);
            } catch (e) {
                addMessage(`–û—à–∏–±–∫–∞ JSON: ${e.message}`, 'error');
            }
        }

        function joinRoom() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                return;
            }

            const roomId = document.getElementById('roomInput').value.trim();
            if (!roomId) {
                addMessage('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã', 'error');
                return;
            }

            ws.send(JSON.stringify({
                type: 'join_room',
                roomId: roomId
            }));

            addMessage(`–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ: ${roomId}`);
        }

        function leaveRoom() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                return;
            }

            if (!currentRoom) {
                addMessage('–ù–µ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫–æ–º–Ω–∞—Ç–µ', 'error');
                return;
            }

            ws.send(JSON.stringify({
                type: 'leave_room'
            }));

            addMessage(`–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É: ${currentRoom}`);
        }

        function updateRoomStatus(roomId) {
            currentRoom = roomId;
            roomStatusDiv.textContent = roomId ? `–í –∫–æ–º–Ω–∞—Ç–µ: ${roomId}` : '–ù–µ –≤ –∫–æ–º–Ω–∞—Ç–µ';
        }

        function clearMessages() {
            messagesDiv.innerHTML = '';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            connect();
        };
    </script>
</body>
</html> 